# Changelog - Deacon Visitation Rotation System

Code was generated by Claude.ai based on requirements, testing, and feedback initiated by Scott.

All notable changes to this project will be documented in this file.

## [25.0] - 2025-07-09 ⭐ **MAJOR RELEASE**

### 🔔 **Added - Google Chat Notifications (Major Feature)**
- **Module 5 (Notifications)**: New 1288-line module for comprehensive chat integration
- **Automated weekly summaries** via Google Chat webhooks with 2-week lookahead format
- **Configurable scheduling** using spreadsheet cells (K11: day, K13: time)
- **Test/production separation** with automatic mode detection and separate webhooks
- **Rich message formatting** with contact info, Breeze links, and Notes access
- **Manual notification tools**: On-demand summaries and tomorrow's reminders
- **Comprehensive diagnostics**: Test functions and troubleshooting tools
- **Trigger management**: Enable/disable/schedule weekly automation via menu

### 🗓️ **Added - Configurable Resource Links**
- **K19 Calendar URL**: "📅 View Visitation Calendar" links in chat notifications
- **K22 Guide URL**: "📋 Visitation Guide" links for ministry procedures and guidelines
- **K25 Summary URL**: "📊 Schedule Summary" links for archived schedules and summaries
- **Test/production switching**: Easy environment changes by updating URLs in K19/K22/K25
- **Graceful degradation**: Links only appear when respective fields are configured
- **Mobile optimization**: All resource links work on mobile devices for field access
- **Calendar integration**: Direct access to visitation schedule from notifications

### 🏗️ **Enhanced - System Architecture**
- **5-module structure**: Dedicated Module 5 for notification functionality
- **Modular webhook integration**: Notifications don't affect core scheduling logic
- **Independent deployment**: Add notifications to existing v24.2 systems
- **Cross-module communication**: Shared constants and function availability
- **Enhanced error handling**: Module-specific error identification and recovery

### 🎛️ **Enhanced - Menu System**
- **Notifications submenu**: Complete automation control (📢 Notifications)
  - 💬 Send Weekly Chat Summary
  - ⏰ Send Tomorrow's Reminders
  - 🔧 Configure Chat Webhook
  - 📋 Test Notification System
  - 🔄 Enable Weekly Auto-Send
  - 📅 Show Auto-Send Schedule
  - 🛑 Disable Weekly Auto-Send
- **Enhanced menu structure**: Logical grouping with clear descriptions
- **Dynamic mode indicators**: Shows 🧪 for test mode, ✅ for production
- **Improved user guidance**: Better descriptions and safety warnings

### 📊 **Enhanced - Spreadsheet Configuration**
- **Column K reorganization**: Cleaner, more logical layout
  - K10-K13: Notification configuration with data validation ⭐ NEW
  - K15-K16: Test mode indicators (moved from K11-K12)
  - K18-K19: Calendar URL configuration ⭐ NEW
- **Data validation dropdowns**: Prevent configuration errors
  - K11: Day selection (Sunday-Saturday)
  - K13: Hour selection (0-23)
- **Visual enhancements**: Color-coded headers and input fields
- **Buffer spacing**: Improved organization with logical grouping

### 🔧 **Enhanced - Trigger System**
- **Robust trigger creation**: Handles Google Apps Script API inconsistencies
- **Comprehensive error handling**: Graceful failures with user feedback
- **Configuration validation**: Ensures valid day/time settings before creation
- **Automatic scheduling**: Google Apps Script manages weekly execution
- **Limitation awareness**: Built-in handling of 15-20 minute delays

### 🧪 **Enhanced - Test Mode Detection**
- **Real-time indicator updates**: K16 shows current mode without reload
- **Enhanced detection triggers**: Multiple data pattern recognition
- **Mode-aware operations**: Different behavior for test vs production
- **Visual feedback**: Clear status indicators and confirmation dialogs
- **Webhook separation**: Test and production chat spaces isolated

### 🔍 **Enhanced - Diagnostic Tools**
- **Notification testing**: Verify webhook configuration and delivery
- **Calendar link validation**: Test K19 URL configuration
- **System health checks**: Comprehensive validation of all components
- **Error troubleshooting**: Built-in tools for identifying issues
- **Performance monitoring**: Logging and progress tracking

### 🚀 **Enhanced - Performance & Reliability**
- **Rate limiting protection**: Intelligent delays for Google API quotas
- **Batch processing**: Optimized for large schedules and datasets
- **Error isolation**: Individual failures don't stop entire operations
- **Memory management**: Efficient handling of large datasets
- **Recovery mechanisms**: Automatic retry for transient failures

### 📋 **File Structure Changes**
```
📁 deacon-visitation-rotation
├── src/
│   ├── module1-core-config.js           (~500 lines)
│   ├── module2-algorithm.js             (~470 lines)
│   ├── module3-smart-calendar.js        (~200 lines)
│   ├── module4-export-menu.js           (~400 lines)
│   └── module5-notifications.js         (~1288 lines) ⭐ NEW
├── docs/
│   ├── README.md                        (Updated for v25.0)
│   ├── SETUP.md                         (Updated with notifications)
│   ├── FEATURES.md                      (Updated with chat integration)
│   └── CHANGELOG.md                     (This file)
└── test/
    └── test_data-table.md               ⭐ NEW
```

### 🆕 **New Functions (Module 5)**
- `sendWeeklyVisitationChat()` - Main weekly notification function
- `sendTomorrowReminders()` - Day-before visit notifications
- `buildChatMessage()` - Rich message formatting with resource links
- `sendToChatSpace()` - Webhook communication handler
- `getUpcomingVisits()` - Smart visit filtering with calendar week logic
- `configureNotifications()` - Interactive webhook setup
- `testNotificationSystem()` - Comprehensive testing suite
- `createWeeklyNotificationTrigger()` - Automated scheduling setup
- `getResourceLinksFromSpreadsheet()` - K19/K22/K25 URL retrieval
- `validateScheduleDataSync()` - Data integrity checking

### 🔧 **Modified Functions**
- `setupHeaders()` (Module 1): Added K10-K13, K18-K19, K21-K22, K24-K25 configuration
- `createMenuItems()` (Module 4): Enhanced with notifications submenu
- `addModeIndicatorToSheet()` (Module 3): Updated to use K15-K16
- `getCurrentTestMode()` (Module 3): Enhanced detection with new patterns

### 📚 **Documentation Updates**
- **README.md**: Added Google Chat features and K19 configuration
- **SETUP.md**: Comprehensive notifications setup guide with calendar links
- **FEATURES.md**: Technical deep-dive into notification system architecture
- **New webhook setup guide**: Step-by-step Google Chat integration

### ⚠️ **Known Limitations**
- **Google Apps Script triggers**: 15-20+ minute delays are normal behavior
- **New trigger reliability**: Triggers need 24-48 hours to "settle" for consistency
- **Service dependencies**: Occasional Google service interruptions affect delivery
- **Quota limits**: Daily execution time limits for complex operations

### 🎯 **Breaking Changes**
- **Column K layout**: K11-K12 moved to K15-K16 (automatic migration in setupHeaders)
- **Test mode detection**: Enhanced patterns may change mode detection behavior
- **Menu structure**: New submenu organization (all functions remain accessible)



---
## [v24.2] - 2025-07-04

### 🏗️ Native Modular Architecture
- **Google Apps Script native file structure** eliminates file combination workflow
- **Four separate .gs files** for clean development and maintenance
- **Streamlined deployment** - copy individual modules directly to Apps Script
- **Better debugging** - errors point to specific files and functions
- **Cleaner version control** - git changes show exactly which module was modified

### 🎯 Smart Calendar Update System
- **Smart calendar update functions** that preserve deacon scheduling customizations
- **Contact info only updates** - preserves all custom times, dates, guests, locations
- **Future events only updates** - preserves current week while updating future visits
- **Enhanced full regeneration** with clear warnings about losing customizations

### 🧪 Intelligent Test Mode Detection ⭐ **NEW**
- **Automatic test mode detection** based on spreadsheet data patterns
- **Visual indicators** in spreadsheet (cells K11-K12) with color coding
- **Real-time mode updates** - indicators refresh when data changes
- **Clear user communication** with popup notifications explaining detected mode
- **Smart triggers**: Test household names, 555 phone numbers, test Breeze numbers, spreadsheet title
- **Safety-first approach** - defaults to production mode when uncertain

### 📅 New Smart Calendar Functions
- **`updateContactInfoOnly()`** - Updates phone, address, Breeze links, Notes links only
- **`updateFutureEventsOnly()`** - Updates events starting next week, preserves current week
- **`getOrCreateCalendar()`** - Helper function for calendar validation and access
- **Smart event parsing** - Extracts household names from event titles for matching

### 🧪 New Test Mode Functions ⭐ **NEW**
- **`detectAndCommunicateTestMode()`** - Intelligent detection with user communication
- **`refreshModeDetection()`** - Real-time mode updates without spreadsheet reload
- **`getCurrentTestMode()`** - Dynamic mode checking for calendar functions
- **`showModeNotification()`** - Enhanced mode display with detection triggers
- **`addModeIndicatorToSheet()`** - Visual mode indicator in spreadsheet cells

### 🎛️ Enhanced Menu System
- **New submenu structure**: "📆 Calendar Functions" with organized update options
- **Safety-first design** - safer options listed first with clear descriptions
- **Enhanced warnings** for destructive operations with suggested alternatives
- **Logical grouping** - smart calendar functions separated from other exports
- **Dynamic mode display** - menu shows current mode icon (🧪 for test, ✅ for production)
- **"Show Current Mode" option** - always accessible mode checking with detection details

### 🛡️ User Experience Improvements
- **Confirmation dialogs** showing exactly what will be preserved/updated
- **Date range messaging** - clear communication about which events are affected
- **Progress tracking** with detailed logging for large operations
- **Success summaries** with counts of events updated/created/deleted
- **Enhanced error handling** with graceful fallbacks and clear error messages
- **Automatic mode detection** - no manual test mode configuration required
- **Visual mode indicators** - persistent spreadsheet cells showing current mode
- **Real-time mode updates** - indicators refresh when data changes without reload
- **Mode explanation dialogs** - clear communication about why test mode was detected

### 📊 Real-World Use Cases Addressed
- **Mid-week contact updates** without losing deacon scheduling details
- **Breeze profile changes** with preserved custom event timing
- **Notes document updates** while maintaining all scheduling customizations
- **Current week protection** - never disrupt ongoing pastoral visit planning
- **Automatic test/production switching** - seamless transition from testing to live use
- **Development workflow** - safe testing environment without manual configuration
- **User training** - clear mode indicators prevent confusion during onboarding

### 🔧 Technical Enhancements
- **Smart event parsing** using regex to match households in event titles
- **Graceful data handling** for households that may have been removed
- **Rate limiting consistency** maintains v24.1 API protection standards
- **Error isolation** prevents individual failures from stopping entire process
- **Dynamic mode detection** with multiple data pattern triggers
- **Real-time indicator updates** without requiring spreadsheet reload
- **Intelligent calendar selection** based on current mode detection
- **Enhanced dialog messaging** with mode-aware confirmation prompts

### 📁 File Structure (v24.2)
#### **GitHub Repository:**
```
📁 deacon-visitation-rotation
├── src/
│   ├── module1-core-config.js           (~500 lines)
│   ├── module2-algorithm.js             (~470 lines)
│   ├── module3-smart-calendar.js        (~200 lines)
│   └── module4-export-menu.js           (~400 lines)
├── docs/
│   ├── README.md
│   ├── SETUP.md
│   └── CHANGELOG.md
└── examples/
```

#### **Google Apps Script Project:**
```
📁 Your Apps Script Project
├── Module1_Core_Config.gs
├── Module2_Algorithm.gs
├── Module3_Smart_Calendar.gs
└── Module4_Export_Menu.gs
```

### 📱 Enhanced Menu Structure (v24.2)
```
🔄 Deacon Rotation
├── 📅 Generate Schedule
├── 🔗 Generate Shortened URLs
├── 📆 Calendar Functions                    ⭐ NEW SUBMENU
│   ├── 📞 Update Contact Info Only         ⭐ NEW - Safest option
│   ├── 🔄 Update Future Events Only        ⭐ NEW - Current week safe
│   └── 🚨 Full Calendar Regeneration       (Enhanced warnings)
├── 📊 Export Individual Schedules
├── 📁 Archive Current Schedule
├── 🗓️ Generate Next Year
├── 🔧 Validate Setup
├── 🧪 Run Tests
├── [🧪/✅] Show Current Mode               ⭐ NEW - Dynamic mode indicator
└── ❓ Setup Instructions
```

### 🎯 Problem Solved
**Original Challenge**: Contact information changes required complete calendar regeneration, losing all custom deacon scheduling details (modified times, dates, guests, locations).

**Additional Challenge**: Manual test mode configuration buried in code caused confusion and required technical knowledge to manage.

**Solution**: Smart calendar update system with flexible options and intelligent test mode detection:
- **Contact info only** - preserves ALL scheduling details
- **Future events only** - protects current week planning  
- **Full regeneration** - enhanced warnings with safer alternatives suggested
- **Native modular architecture** - eliminates complex file combination workflow
- **Automatic test mode detection** - no manual configuration required, seamless transition from testing to production

### 🔄 Development Workflow Improvements
#### **Previous Workflow:**
```
Edit modules in GitHub → Combine into single file → Copy to Apps Script → Test
```

#### **New Workflow (v24.2):**
```
Edit modules in GitHub → Copy individual files to Apps Script → Test
```

### 📈 Architecture Benefits
- **50% faster development** - no file combination step required
- **Better debugging** - errors show exact file and function location
- **Easier maintenance** - edit only the module you need to change
- **Cleaner git history** - changes show specific functionality modified
- **Team collaboration** - multiple developers can work on different modules

---

## [v24.1] - 2025-06-07

### 🔗 Breeze & Notes Integration
- **Breeze Church Management System integration** with profile links
- **Google Docs visit notes integration** with direct access
- **Automatic URL shortening** using TinyURL's free API
- **Enhanced calendar events** with clickable Breeze profiles and notes pages
- **Intelligent link handling** with fallback support

### 🎯 New Column Structure
- **Column P**: Breeze Link (8-digit numbers from Breeze CMS)
- **Column Q**: Notes Pg Link (Google Doc URLs for visit documentation)
- **Column R**: Breeze Link (short) - Auto-generated shortened URLs
- **Column S**: Notes Pg Link (short) - Auto-generated shortened URLs

### 📅 Enhanced Calendar Export
- **Rich event descriptions** with Breeze profiles and visit notes
- **Improved formatting** with structured contact information
- **Rate limiting protection** to handle Google Calendar API limits
- **Batch processing** for large schedules (pauses every 25 events)
- **Intelligent deletion** with cooldown periods

### 🔧 New Functionality
- **URL Shortening Service**: Free TinyURL integration without account requirements
- **Breeze URL Construction**: Automatic full URL building from 8-digit numbers
- **Menu Enhancement**: New "🔗 Generate Shortened URLs" option
- **Validation Updates**: Enhanced setup reporting with link counts
- **System Testing**: URL shortening and Breeze URL construction tests

### 🛡️ Rate Limiting & Reliability
- **Google Calendar API protection** with strategic delays
- **Batch deletion** (pauses every 10 deletions)
- **Batch creation** (pauses every 25 creations)
- **2-second cooldown** between deletion and creation phases
- **Progress logging** for large operations
- **Graceful error handling** with individual event failure isolation

### 📋 Calendar Event Format
New enhanced format includes:
```
Household: [household name]
Breeze Profile: [shortened breeze link]

Contact Information:
Phone: [phone number]
Address: [address]

Visit Notes: [shortened notes link]

Instructions:
[calendar instructions from K8]
```

---

## [v24.0] - 2025-06-07

### 🔄 Major Modular Refactoring
- **Modular code architecture** with three separate, maintainable modules
- **Optimized column layout** for improved user experience and data organization
- **Enhanced deacon reports positioning** for better workflow integration
- **Streamlined configuration placement** for easier setup and maintenance

### 🎯 Column Layout (Enhanced in v24.1, Maintained in v24.2)
- **A-E**: Main rotation schedule
- **F**: Buffer column for visual separation
- **G-I**: Individual deacon reports (moved from L-N for better adjacency)
- **J**: Buffer column for visual separation
- **K**: Configuration settings (consolidated)
- **L**: Deacon names list
- **M**: Household names list
- **N-O**: Contact information (phone numbers and addresses)
- **P-S**: Breeze and Notes integration (added in v24.1)

### 📁 Modular Architecture Evolution
- **v24.0**: Three combined modules for easier deployment
- **v24.1**: Enhanced modules with Breeze/Notes integration
- **v24.2**: Native Google Apps Script files for direct development

---

## Development History

### [v23.1] - Previous Stable Version
- **Enhanced system testing** with detailed logging and diagnostics
- **Robust error handling** throughout all functions
- **Contact information integration** (phone numbers and addresses)
- **Enhanced calendar export** with contact details and custom instructions
- **Archive function fixes** for proper data preservation

### [v23.0] - Major Algorithm Overhaul
- **Pre-calculated optimal rotation patterns** replacing real-time generation
- **Intelligent scoring system** for deacon assignments
- **Complete elimination** of harmonic resonance issues

### [v20.0-v22.0] - Contact Information & Anti-Harmonic Development
- **Contact information storage** in dedicated columns
- **Harmonic resonance detection** and mitigation
- **Enhanced calendar events** with phone numbers and addresses

### [v15.0-v19.0] - Robustness and Safety
- **Comprehensive input validation** for all configuration fields
- **Workload feasibility checking** with specific recommendations
- **Safety limits** for large schedules and execution timeouts

### [v10.0-v14.0] - Export and Integration Features
- **Google Calendar export** with automated event creation
- **Individual deacon schedules** in separate spreadsheets
- **Archive functionality** for historical preservation

### [v5.0-v9.0] - Core Algorithm Development
- **Basic rotation algorithms** with round-robin distribution
- **Date calculation and validation** systems
- **Google Sheets integration** and data reading

### [v1.0-v4.0] - Foundation and Setup
- **Basic project structure** and Google Apps Script setup
- **Simple rotation logic** and schedule generation

---

## 🐛 Major Issues Resolved

### Development Workflow Efficiency (v24.2)
**Issue**: Complex file combination workflow slowed development and made debugging difficult.

**Solution**: Native Google Apps Script modular architecture with:
- Four separate .gs files for direct editing
- Elimination of file combination step
- Individual module testing capabilities
- Better error location identification
- Cleaner version control with module-specific changes

### Smart Calendar Update Challenge (v24.2)
**Issue**: Contact information changes required complete calendar regeneration, losing all deacon scheduling customizations (modified times, dates, guests, locations).

**Solution**: Implemented flexible calendar update system with:
- Contact info only updates that preserve ALL scheduling details
- Future events only updates that protect current week's planning
- Enhanced warnings for destructive full regeneration
- Smart event parsing and data matching
- Comprehensive user guidance and confirmation dialogs

### Google Calendar API Rate Limiting (v24.1)
**Issue**: Rapid deletion and creation of calendar events triggered Google's API rate limits, causing "too many calendar operations" errors.

**Solution**: Implemented intelligent rate limiting with:
- Batch deletion with pauses every 10 events
- 2-second cooldown between deletion and creation phases
- Batch creation with pauses every 25 events
- Progress logging for transparency
- Individual event error isolation to prevent cascade failures

### URL Shortening Integration (v24.1)
**Issue**: Need for shortened URLs to improve calendar event descriptions and provide easy access to Breeze profiles and visit notes.

**Solution**: Integrated TinyURL's free API with:
- No account requirements for ease of deployment
- Automatic Breeze URL construction from 8-digit numbers
- Fallback to full URLs if shortening fails
- Batch processing with delays to respect API limits
- Storage of shortened URLs in dedicated columns for reuse

### Church Management System Integration (v24.1)
**Issue**: Deacons needed quick access to household information in Breeze CMS and visit documentation in Google Docs during pastoral visits.

**Solution**: Comprehensive integration system with:
- Direct links to Breeze profiles using 8-digit identifiers
- Google Docs integration for visit notes and documentation
- Enhanced calendar events with clickable links
- Automatic URL shortening for cleaner presentation
- Structured event descriptions with clear information hierarchy

### Column Layout Optimization (v24.0)
**Issue**: Previous column layout had deacon reports far from main schedule and configuration scattered across multiple locations.

**Solution**: Comprehensive layout redesign that positioned deacon reports adjacent to main schedule and consolidated configuration settings.

### Harmonic Resonance Problem (v18.0-v23.0)
**Issue**: Mathematical harmonics in deacon/household ratios caused deacons to visit only the same household(s) repeatedly.

**Solution**: Developed optimal pattern generator with intelligent scoring system that guarantees variety while maintaining fairness.

---

## 🚀 Planned Future Enhancements

### **v25.1 - Planned Improvements**
- **Enhanced error recovery**: Better handling of Google service interruptions
- **Advanced scheduling**: Custom visit frequency per household
- **Email integration**: Optional email notifications alongside chat

### **v26.0 - Advanced Features**
- **Visit completion tracking**: Mark visits as completed with feedback
- **Analytics dashboard**: Visit statistics and deacon performance metrics
- **Multi-church support**: Configuration for multiple church installations
- **Advanced customization**: Templated message formats and scheduling rules

### **v27.0 - Extended Integration**
- **Planning Center integration**: Sync with additional church management systems
- **SMS notifications**: Mobile text message alerts for urgent scheduling
- **Advanced reporting**: Historical analysis and trend identification
- **API development**: External integration capabilities for third-party tools

---

## 📈 Development Statistics

- **Total development time**: ~2+ months
- **Lines of code**: 3,400+ lines (optimized modular architecture)
- **Major iterations**: 24+ versions
- **Key algorithms developed**: 5 (optimal pattern, harmonic mitigation, workload balancing, URL shortening, smart calendar updates)
- **Functions implemented**: 40+ specialized functions
- **External API integrations**: 2 (Google Calendar, TinyURL)
- **Testing scenarios**: 200+ deacon/household ratio combinations
- **Architecture improvements**: 2 major refactorings (v24.0 modular, v25 notifications)

---

## 🏆 Key Achievements

### Mathematical Innovation
- **Solved harmonic resonance** - a complex mathematical problem in rotation scheduling
- **Optimal pattern generation** - guarantees fair distribution regardless of ratios
- **Intelligent scoring system** - balances workload while maximizing variety

### Real-World Usability
- **Smart calendar updates** - preserves real-world scheduling customizations
- **Church management integration** - seamless workflow with existing systems
- **Native modular architecture** - professional development experience

### Technical Excellence
- **Rate limiting protection** - handles Google API limits gracefully
- **Comprehensive error handling** - graceful degradation and helpful error messages
- **Extensive testing framework** - validates all functionality automatically

---

**Version Numbering**: This project uses semantic versioning where major releases (24.0, 25.0) indicate significant feature additions or architectural changes, minor releases (24.1, 24.2) add functionality without breaking changes, and patch releases (25.0.1) address bugs and small improvements.

**Support**: For technical support or feature requests, refer to the [Setup Guide](https://claude.ai/chat/SETUP.md) and [Features Documentation](https://claude.ai/chat/FEATURES.md). The system is designed for churches using Google Workspace and includes comprehensive diagnostic tools for troubleshooting.

---

**This changelog reflects the evolution from a simple rotation script to a sophisticated, integrated church management tool with smart calendar update capabilities and professional development architecture.** 🎯
